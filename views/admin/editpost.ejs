<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <title>Admin</title>
</head>

<body>
    <div class="body">
        <%- include('../partials/admin/navbarsave'); %>
            <div class="mainarea" style="align-items: flex-start; align-content: flex-start;overflow-y: auto;">
                <div style="width: 900px; height: auto; padding: 20px 50px;">
                    <div id="editor" style="min-height: 90vh;">
                        <form action="/admin/uploadimageedit" method="POST" enctype="multipart/form-data">
                            <input type="text" name="data" class="datainput" style="display: none;">
                            <div style="width: 90%; display: block; margin: 20px auto;">

                                <p class="caption" style="margin-bottom: 4px;">Post Image</p>
                                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                                    <img id="postImage" src="uploads/resized/<%= nsdata.headerImage %> " alt="your image" style="width: 50%; margin: auto; display: block; margin-bottom: 30px;" />
                                    <input type="file" id="postImageinput" onchange="headerImage('postImage')" name="image" />
                                    <button type="submit">Upload</button>
                                </div>
                            </div>
                        </form>
                        <div style="width: 90%; margin: 20px auto;">
                            <p class="caption" style="margin-bottom: 4px;">Post Title</p>
                            <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                                <h1 id="postTitle">
                                    <%= nsdata.postTitle %>
                                </h1>
                                <input type="text" name="posttitle" value="<%= nsdata.postTitle %>" class="item-input" id="postTitleinput" onkeyup="document.getElementById('postTitle').innerText = document.getElementById('postTitleinput').value;  addHeaderData('postTitleinput', 'postTitle')"
                                    placeholder="Heading Text...">
                            </div>
                        </div>
                        <div style="width: 90%; margin: 20px auto;">
                            <p class="caption" style="margin-bottom: 4px;">Post Sub Text</p>
                            <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                                <p id="postsubtext">
                                    <%= nsdata.underText %>
                                </p>
                                <input type="text" name="postsubtext" value="<%= nsdata.underText %>" class="item-input" id="postsubtextinput" onkeyup="document.getElementById('postsubtext').innerText = document.getElementById('postsubtextinput').value;  addHeaderData('postsubtextinput', 'underText')"
                                    placeholder="Post Sub Text...">
                            </div>
                        </div>
                        <div style="width: 90%; margin: 20px auto;">
                            <p class="caption" style="margin-bottom: 4px;">Post Author</p>
                            <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                                <p id="postauthor">
                                    <%= nsdata.author %>
                                </p>
                                <input type="text" name="postauthor" value="<%= nsdata.author %>" class="item-input" id="postauthorinput" onkeyup="document.getElementById('postauthor').innerText = document.getElementById('postauthorinput').value; addHeaderData('postauthorinput', 'author')"
                                    placeholder="Post Author...">
                            </div>
                        </div>
                        <div style="width: 90%; margin: 20px auto;">
                            <p class="caption" style="margin-bottom: 4px;">Post Category</p>
                            <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                                <p id="postcategory">
                                    <%= nsdata.category %>
                                </p>
                                <input type="text" name="postcategory" value="<%= nsdata.category %>" class="item-input" id="postcategoryinput" onkeyup="document.getElementById('postcategory').innerText = document.getElementById('postcategoryinput').value; addHeaderData('postcategoryinput', 'category')"
                                    placeholder="Post Category...">
                            </div>
                        </div>

                    </div>
                    <div>
                        <div class="additemdropdownbutton" onclick="showItems()">
                            <p style=" width: 100%; font-size: 30px; user-select: none;">Add Item
                            </p>
                        </div>
                        <div class="additemdropdown" id="itemdropdown">
                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('heading1')">
                                <img src="imgs/Iconsax-Broken-text.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Heading 1
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('heading2')">
                                <img src="imgs/Iconsax-Broken-text.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Heading 2
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('heading3')">
                                <img src="imgs/Iconsax-Broken-text.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Heading 3
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('heading4')">
                                <img src="imgs/Iconsax-Broken-text.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Heading 4
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('paragraph')">
                                <img src="imgs/Iconsax-Broken-text.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Paragraph
                                </p>
                            </div>

                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('image')">
                                <img src="imgs/Iconsax-Broken-image1.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Image
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('video')">
                                <img src="imgs/Iconsax-Broken-video.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Video
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: row;;" class="addBlock-item" onclick="addBlock('audio')">
                                <img src="imgs/Iconsax-Broken-video.svg" alt="logo" class="postlist-item-icon" style="width: 20px; margin-right: 10px; height: auto;">
                                <p style="color:#303030; width: calc(50% - 150px); min-width: 200px; font-size: 20px; margin: 4px;">
                                    Audio
                                </p>
                            </div>



                        </div>
                    </div>
                    <form action="/admin/save-edit" id="saveform" method="POST">
                        <input type="text" name="data" id="datainput" style="display: none ;">
                        <div style="height: fit-content; display: flex; flex-direction: column; align-items: flex-start; align-content: flex-start; width: 80px; margin-left: 40px; overflow-x: hidden;">
                        </div>
                    </form>
                </div>


            </div>



    </div>
    </div>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        var d = '<%- data %>'
        d = JSON.parse(d)

        var editor = document.getElementById('editor')
        var dataInput = document.getElementById('datainput')
        var dataInputs = document.getElementsByClassName('datainput')

        var data = d

        dataInput.value = JSON.stringify(d)

        console.log("dataInput value and stuff", dataInput.value, typeof dataInput.value)


        dd = d.data

        console.log("this is data", data)

        var showItem = false
        var toolbarOptions = [
            ['bold', 'italic', 'underline', 'strike'], // toggled buttons
            ['blockquote'],


            [{
                'list': 'ordered'
            }, {
                'list': 'bullet'
            }],
            [{
                'script': 'sub'
            }, {
                'script': 'super'
            }], // superscript/subscript
            [{
                'indent': '-1'
            }, {
                'indent': '+1'
            }], // outdent/indent
            [{
                'direction': 'rtl'
            }], // text direction


            [{
                'header': [1, 2, 3, 4, 5, 6, false]
            }],


            [{
                'align': []
            }],

            ['clean'] // remove formatting button

        ];

        function addDataRich(id) {
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].data = document.getElementById(`${id}`).getElementsByClassName('ql-editor')[0].innerHTML
                    console.log(dd[i].data)
                }
            }
            d.data = dd
            dataInput.value = JSON.stringify(d)
            console.log("datainput", dataInput.value)
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }
        }

        function showItems() {
            if (showItem == false) {
                document.getElementById('itemdropdown').style.display = 'flex'
                showItem = true
            } else if (showItem == true) {
                document.getElementById('itemdropdown').style.display = 'none'
                showItem = false
            }
        }

        for (var i = 0; i < dd.length; i++) {
            if (dd[i].align == '') {
                dd[i].align = 'left';
            }
            if (dd[i].tab == '') {
                dd[i].tab = 'none';
            }
            addBlock1(dd[i].type, dd[i].id, dd[i].data, dd[i].align, dd[i].tab, dd[i].caption)
        }

        function addBlock1(item, elid, data, align, tab, caption) {
            if (item == 'heading1') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
              <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>

          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
            <h1 style="text-align: ${align};" id="${elid}">${data}</h1>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'heading2') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>  

          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
            <h2 style="text-align: ${align};" id="${elid}">${data}</h2>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'heading3') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>  

          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
            <h3 style="text-align: ${align};" id="${elid}">${data}</h3>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'heading4') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>  

          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
            <h4  style="text-align: ${align};"id="${elid}">${data}</h4>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'paragraph') {
                var t = 0
                if (tab == '1') {
                    t = 30
                } else if (tab == '2') {
                    t = 60
                }
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>  

          <p class="caption" style="margin-bottom: 4px;">Paragraph</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
            
            <p style="text-align: ${align}; text-indent: ${t}px;" id="${elid}">${data}</p>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Paragraph Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    <div style="display: flex; flex-direction: row; margin-top: 0px; margin-left: 30px;">
                        <button class="align-button-start" onclick="tab('none', '${elid}')">No
                                Tab</button>
                        <button class="align-button" onclick="tab('1', '${elid}')">1</button>
                        <button class="align-button-end" onclick="tab('2', '${elid}')">2</button>

                    <div style="display: flex; flex-direction: row;">  

                    </div>
                
          </div>
      </div>`

            } else if (item == 'image') {

                datainputs += 1
                editor.innerHTML += `
        <form action="/admin/uploadimageedit" method="POST" enctype="multipart/form-data">
        <input type="text" name="data" class="datainput" style="display: none;">
            <div style="width: 90%; display: block; margin: 20px auto;">
              <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>  
              <p class="caption" style="margin-bottom: 4px;">Image</p>
                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                    <img id="${elid}" src="uploads/resized/${data}" alt="your image" style="width: 50%; margin: auto; display: block; margin-bottom: 30px;" />
                    <input type="file" id="${elid}input" onchange="uploadImage('${elid}')" name="image" />
                    <button type="submit">Upload</button>
                    <input type="text" class="item-input" value="${caption}" style="margin-top: 20px;" id="${elid}inputcap" onkeyup="addDataCaption('${elid}');" placeholder="Caption...">
                </div>
            </div>
        </form>`
                forms += 1

            } else if (item == 'video') {
                datainputs += 1
                editor.innerHTML += `
        <form action="/admin/uploadvideoedit" method="POST" enctype="multipart/form-data">
            <input type="text" name="data" class="datainput" style="display: none;">
            <div style="width: 90%; display: block; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
                <p class="caption" style="margin-bottom: 4px;">Video</p>
                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                    <video style="width: 100%; margin-bottom: 20px; border-radius: 15px;" controls>
                        <source id="${elid}imagesource" src="uploads/${data}">
                        Your browser does not support HTML video.
                    </video>
                    <input type="file" id="${elid}input" name="video" onchange="readVideo('${elid}')"  type="video/*" />
                    <button type="submit">Upload</button>
                </div>
            </div>
        </form>`
                forms += 1

            } else if (item == 'audio') {
                datainputs += 1

                console.log("audo", data)
                editor.innerHTML += `
        <form action="/admin/uploadaudioedit" method="POST" enctype="multipart/form-data">
            <input type="text" name="data" class="datainput" style="display: none;">
            <div style="width: 90%; display: block; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
                <p class="caption" style="margin-bottom: 4px;">Audio</p>
                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                    <audio controls style="margin-bottom: 10px;">
                                <source src="uploads/${data}" id="${elid}audiosrc" >

                                Your browser does not support the audio element.
                            </audio>
                            <br>
                            <br>
                    <input type="file" id="${elid}input" name="audio" onchange="readAudio('${elid}')"  type="audio/*" />
                    <button type="submit">Upload</button>
                </div>
            </div>
        </form>`
                forms += 1

            } else if (item == 'richtext') {


                editor.innerHTML += `
       <div style="width: 90%; margin: 20px auto; margin-top: 30px;">
            <a onclick="deleteItem('${elid}')" style="margin-top: -20px; float: right;" class="postlist-item-button-delete">Delete</a>
            <div id="${elid}" onkeyup="addDataRich('${elid}')">
                ${data}
            </div>
        </div>`

                var quill = new Quill(`#${elid}`, {
                    modules: {
                        toolbar: toolbarOptions
                    },
                    theme: 'snow'
                });

            }
        }

        var forms = 0
        var datainputs = 0

        console.log("log all imported data", d)

        function addData(id) {
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].data = document.getElementById(`${id}input`).value
                }
            }
            d.data = dd
            dataInput.value = JSON.stringify(d)
            console.log("datainput1", dataInput.value, d)
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }
        }

        function addHeaderData(id, item) {
            console.log(id, item)
            d[item] = document.getElementById(`${id}`).value
            if (item == 'postTitle') {
                d['slug'] = titleToSlug(document.getElementById(`${id}`).value)
            }

            dataInput.value = JSON.stringify(d)
            console.log("datainput1", dataInput.value, d)

        }

        function deleteItem(id) {
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd.splice(i, 1)
                    editor.innerHTML = ''
                    for (var i = 0; i < dd.length; i++) {
                        if (dd[i].align == '') {
                            dd[i].align = 'left';
                        }
                        if (dd[i].tab == '') {
                            dd[i].tab = 'none';
                        }
                        addBlock1(dd[i].type, dd[i].id, dd[i].data, dd[i].align, dd[i].tab, dd[i].caption)
                    }
                    d.data = dd
                    dataInput.value = JSON.stringify(d)
                }
            }
        }

        function addDataCaption(id) {
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].caption = document.getElementById(`${id}inputcap`).value
                }
            }
            d.data = dd
            dataInput.value = JSON.stringify(d)
            console.log("datainput2", dataInput.value, d)
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }
        }

        function align(align, id) {
            document.getElementById(id).style.textAlign = align
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].align = align
                    d.data = dd
                    dataInput.value = JSON.stringify(d)
                }
            }
        }

        function tab(tab, id) {
            if (tab == 'none') {
                document.getElementById(id).style.textIndent = '0px'
            } else if (tab == '1') {
                document.getElementById(id).style.textIndent = '30px'
            } else if (tab == '2') {
                document.getElementById(id).style.textIndent = '60px'
            }
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].tab = tab
                    d.data = dd
                    dataInput.value = JSON.stringify(d)
                }
            }
        }

        function uploadImage(id) {
            const [file] = document.getElementById(`${id}input`).files
            if (file) {
                document.getElementById(`${id}`).src = URL.createObjectURL(file)
            }
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].data = document.getElementById(`${id}input`).files[0].name
                }
            }
            d.data = dd

            dataInput.value = JSON.stringify(d)
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }

        }

        function headerImage(id) {
            const [file] = document.getElementById(`${id}input`).files
            if (file) {
                document.getElementById(`${id}`).src = URL.createObjectURL(file)
                d.headerImage = document.getElementById(`${id}input`).files[0].name
                dataInput.value = JSON.stringify(d)
                console.log(d, dataInput.value, JSON.parse(dataInput.value))
            }
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }

        }

        function readVideo(id) {
            let file = document.getElementById(`${id}input`).files[0];
            let blobURL = URL.createObjectURL(file);
            document.getElementById(`${id}imagesource`).src = blobURL;
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].data = document.getElementById(`${id}input`).files[0].name
                }
            }
            dataInput.value = JSON.stringify(d)
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }
        }

        function readAudio(id) {
            let file = document.getElementById(`${id}input`).files[0];
            let blobURL = URL.createObjectURL(file);
            document.getElementById(`${id}audiosrc`).src = blobURL;
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].data = document.getElementById(`${id}input`).files[0].name
                }
            }
            dataInput.value = JSON.stringify(d)
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }
        }

        function addDataRich(id) {
            for (var i = 0; i < dd.length; i++) {
                if (dd[i].id == id) {
                    dd[i].data = document.getElementById(`${id}`).getElementsByClassName('ql-editor')[0].innerHTML
                    console.log(dd[i].data)
                }
            }
            dataInput.value = JSON.stringify(d)
            console.log("datainput", dataInput.value)
            for (var i = 0; i < dataInputs.length; i++) {
                dataInputs[i].value = JSON.stringify(d)
            }
        }

        function addBlock(item) {
            if (item == 'heading1') {
                var elid = generateString(8)
                editor.innerHTML += `
        <div style="width: 90%; margin: 20px auto;">
          <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
            <p class="caption" style="margin-bottom: 4px;">Heading</p>
            <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                <h1 id="${elid}">Heading Text</h1>
                <input type="text" class="item-input" id="${elid}input" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
                <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
            </div>
        </div>`
                dd.push({
                    id: `${elid}`,
                    type: 'heading1',
                    data: '',
                    align: ''
                })
            } else if (item == 'heading2') {
                var elid = generateString(8)
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
        <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
              <h2 id="${elid}">Heading Text</h2>
              <input type="text" class="item-input" id="${elid}input" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
            <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                </div>
            </div>
      </div>`
                dd.push({
                    id: `${elid}`,
                    type: 'heading2',
                    data: '',
                    align: ''
                })
            } else if (item == 'heading3') {
                var elid = generateString(8)
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
        <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
              <h3 id="${elid}">Heading Text</h3>
              <input type="text" class="item-input" id="${elid}input" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
                <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                </div>
            </div>
      </div>`
                dd.push({
                    id: `${elid}`,
                    type: 'heading3',
                    data: '',
                    align: ''
                })
            } else if (item == 'heading4') {
                var elid = generateString(8)
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
        <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
              <h3 id="${elid}">Heading Text</h3>
              <input type="text" class="item-input" id="${elid}input" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                </div>
          </div>
      </div>`
                dd.push({
                    id: `${elid}`,
                    type: 'heading4',
                    data: '',
                    align: ''
                })
            } else if (item == 'paragraph') {
                var elid = generateString(8)
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
        <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
          <p class="caption" style="margin-bottom: 4px;">Paragraph</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
              <p id="${elid}">Paragraph Text</p>
              <input type="text" class="item-input" id="${elid}input" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Paragraph Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    <div style="display: flex; flex-direction: row; margin-top: 0px; margin-left: 30px;">
                        <button class="align-button-start" onclick="tab('none', '${elid}')">No
                                Tab</button>
                        <button class="align-button" onclick="tab('1', '${elid}')">1</button>
                        <button class="align-button" onclick="tab('2', '${elid}')">2</button>

                    <div style="display: flex; flex-direction: row;">  

                    </div>
                </div>
                </div>
                
          </div>
      </div>`
                dd.push({
                    id: `${elid}`,
                    type: 'paragraph',
                    data: '',
                    align: '',
                    tab: ''
                })
            } else if (item == 'image') {
                var elid = generateString(8)
                datainputs += 1
                editor.innerHTML += `
        <form action="/admin/uploadimageedit" method="POST" enctype="multipart/form-data">
            <input type="text" name="data" class="datainput" style="display: none;">
            <div style="width: 90%; display: block; margin: 20px auto;">
              <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
                <p class="caption" style="margin-bottom: 4px;">Image</p>
                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                    <img id="${elid}" src="imgs/background-icon.svg" alt="your image" style="width: 50%; margin: auto; display: block; margin-bottom: 30px;" />
                    <input type="file" id="${elid}input" onchange="uploadImage('${elid}')" name="image" />
                    <button type="submit">Upload</button>
                    <input type="text" class="item-input" style="margin-top: 20px;" id="${elid}inputcap" onkeyup="addDataCaption('${elid}');" placeholder="Caption...">
                </div>
            </div>
        </form>`
                forms += 1
                dd.push({
                    id: `${elid}`,
                    type: 'image',
                    data: '',
                    caption: ''
                })
            } else if (item == 'video') {
                var elid = generateString(8)
                datainputs += 1
                editor.innerHTML += `
        <form action="/admin/uploadvideoedit" method="POST" enctype="multipart/form-data">
            <input type="text" name="data" class="datainput" style="display: none;">
            <div style="width: 90%; display: block; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
                <p class="caption" style="margin-bottom: 4px;">Video</p>
                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                    <video style="width: 100%; margin-bottom: 20px; border-radius: 15px;" controls>
                        <source id="${elid}imagesource" src="uploads/video.mp4">
                        Your browser does not support HTML video.
                    </video>
                    <input type="file" id="${elid}input" name="video" onchange="readVideo('${elid}')"  type="video/*" />
                    <button type="submit">Upload</button>
                </div>
            </div>
        </form>`
                forms += 1
                dd.push({
                    id: `${elid}`,
                    type: 'video',
                    data: ''
                })
            } else if (item == 'audio') {
                var elid = generateString(8)
                datainputs += 1
                editor.innerHTML += `
        <form action="/admin/uploadaudio" method="POST" enctype="multipart/form-data">
            <input type="text" name="data" class="datainput" style="display: none;">
            <div style="width: 90%; display: block; margin: 20px auto;">
            <a onclick="deleteItem('${elid}')" style="padding-top: -10px; float: right;" class="postlist-item-button-delete">Delete</a>
                <p class="caption" style="margin-bottom: 4px;">Audio</p>
                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid black; background-color: white; color: #323435; border-radius: 0px; padding: 40px;">
                    <audio controls style="margin-bottom: 10px;">
                                <source src="" id="${elid}audiosrc" type="audio/mp3">

                                Your browser does not support the audio element.
                            </audio>
                            <br>
                            <br>
                    <input type="file" id="${elid}input" name="audio" onchange="readAudio('${elid}')"  type="audio/*" />
                    <button type="submit">Upload</button>
                </div>
            </div>
        </form>`
                forms += 1
                dd.push({
                    id: `${elid}`,
                    type: 'audio',
                    data: ''
                })
            } else if (item == 'richtext') {
                var elid = generateString(8)

                elid = elid.replace(' ', '')
                editor.innerHTML += `
       <div style="width: 90%; margin: 20px auto; margin-top: 30px;">
            <a onclick="deleteItem('${elid}')" style="margin-top: -20px; float: right;" class="postlist-item-button-delete">Delete</a>
            <div id="${elid}" onkeyup="addDataRich('${elid}')">
                <p>Hello World!</p>
                <p>Some initial <strong>bold</strong> text</p>
                <p><br></p>
            </div>
        </div>`

                var quill = new Quill(`#${elid}`, {
                    modules: {
                        toolbar: toolbarOptions
                    },
                    theme: 'snow'
                });
                dd.push({
                    id: `${elid}`,
                    type: 'richtext',
                    data: ''
                })
            }


            var inputs = document.getElementsByClassName('item-input')

            if (inputs.length != 0) {
                for (var i = 0; i < inputs.length; i++) {
                    var elementid = inputs[i].id
                    document.getElementById(inputs[i].id).value = document.getElementById(elementid.slice(0, 8)).innerText
                }
            } else {
                console.log("Hello")
            }

            var imageinputs = document.getElementsByClassName('image-input')

            if (imageinputs.length != 0) {
                for (var i = 0; i < imageinputs.length; i++) {
                    var elementid = imageinputs[i].id
                    console.log(document.getElementById(imageinputs[i].id).files)

                    document.getElementById(imageinputs[i].id).files = document.getElementById(imageinputs[i].id).files[0].name
                }
            } else {
                console.log("Hello")
            }

            console.log(dd)
        }

        const titleToSlug = title => {
            let slug;

            // convert to lower case
            slug = title.toLowerCase();

            // remove special characters
            slug = slug.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi, '');
            // The /gi modifier is used to do a case insensitive search of all occurrences of a regular expression in a string

            // replace spaces with dash symbols
            slug = slug.replace(/ /gi, "-");

            // remove consecutive dash symbols 
            slug = slug.replace(/\-\-\-\-\-/gi, '-');
            slug = slug.replace(/\-\-\-\-/gi, '-');
            slug = slug.replace(/\-\-\-/gi, '-');
            slug = slug.replace(/\-\-/gi, '-');

            // remove the unwanted dash symbols at the beginning and the end of the slug
            slug = '@' + slug + '@';
            slug = slug.replace(/\@\-|\-\@|\@/gi, '');
            return slug;
        };

        var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"

        function generateString(length) {
            let result = ''
            const charactersLength = characters.length
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength))
            }

            return result;
        }
    </script>

</body>

</html>