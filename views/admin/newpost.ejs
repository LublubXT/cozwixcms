<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <title>Admin</title>
</head>

<body>
    <div class="body">
        <div class="sidebar">
            <img src="imgs/ccms-logo.svg" alt="logo" class="sidebar-logo">
            <div class="sidebar-link-container">
                <div style="height: fit-content; display: flex; flex-direction: column; align-items: flex-start; align-content: flex-start; width: 120px; margin-left: 15px; overflow-x: hidden;">
                    <a class="post-item" onclick="addBlock('heading1')">- Heading 1</a>
                    <a class="post-item" onclick="addBlock('heading2')">- Heading 2</a>
                    <a class="post-item" onclick="addBlock('heading3')">- Heading 3</a>
                    <a class="post-item" onclick="addBlock('heading4')">- Heading 4</a>
                    <a class="post-item" onclick="addBlock('paragraph')">- Paragraph</a>
                    <a class="post-item" onclick="addBlock('image')">- Image</a>
                </div>
                <div style="height: fit-content; display: flex; flex-direction: column; align-items: flex-start; align-content: flex-start; width: 120px; margin-left: 15px; overflow-x: hidden;">
                    <a href="/admin/posts" class="post-item-logout">- Back</a>
                </div>
            </div>
        </div>
        <div class="mainarea" style="align-items: flex-start; align-content: flex-start;overflow-y: auto;">
            <div style="width: 900px; height: auto; padding: 20px 50px;">
                <div id="editor" style="min-height: 90vh;">



                </div>
                <form action="/admin/save" id="saveform" method="POST">
                    <input type="text" name="data" id="datainput" style="display: none;">
                    <div style="height: fit-content; display: flex; flex-direction: column; align-items: flex-start; align-content: flex-start; width: 80px; margin-left: 40px; overflow-x: hidden;">
                        <button type="submit" style="border: none; background-color: transparent; font-family: 'Varela Round', sans-serif; padding: 0px; margin: 0px; cursor: pointer;" class="sidebar-link">Save</button>
                    </div>
                </form>
            </div>


        </div>



    </div>
    </div>

    <script src="js/newpost.js"></script>
    <script>
        var d = '<%- data %>'
        d = JSON.parse(d)

        var editor = document.getElementById('editor')
        var dataInput = document.getElementById('datainput')
        var dataInputs = document.getElementsByClassName('datainput')

        data = d

        dataInput.value = JSON.stringify(d)

        console.log("dataInput value and stuff", dataInput.value, typeof dataInput.value)


        if (data.length == undefined) {
            data = d.data
            d = d.data
        }

        console.log(data)

        for (var i = 0; i < d.length; i++) {
            if (d[i].align == '') {
                d[i].align = 'left';
            }
            if (d[i].tab == '') {
                d[i].tab = 'none';
            }
            addBlock1(d[i].type, d[i].id, d[i].data, d[i].align, d[i].tab, d[i].caption)
        }

        function deleteItem(id) {
            for (var i = 0; i < data.length; i++) {
                if (data[i].id == id) {
                    data.splice(i, 1)
                    editor.innerHTML = ''
                    for (var i = 0; i < d.length; i++) {
                        if (d[i].align == '') {
                            d[i].align = 'left';
                        }
                        if (d[i].tab == '') {
                            d[i].tab = 'none';
                        }
                        addBlock1(d[i].type, d[i].id, d[i].data, d[i].align, d[i].tab, d[i].caption)
                    }
                    d.data = data
                    dataInput.value = JSON.stringify(d)
                }
            }
        }

        function addBlock1(item, elid, data, align, tab, caption) {
            if (item == 'heading1') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid transparent; background-color: white; border-radius: 5px; padding: 40px;">
              <h1 style="text-align: ${align};" id="${elid}">${data}</h1>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'heading2') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid transparent; background-color: white; border-radius: 5px; padding: 40px;">
              <h2 style="text-align: ${align};" id="${elid}">${data}</h2>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'heading3') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid transparent; background-color: white; border-radius: 5px; padding: 40px;">
              <h3 style="text-align: ${align};" id="${elid}">${data}</h3>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'heading4') {
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
          <p class="caption" style="margin-bottom: 4px;">Heading</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid transparent; background-color: white; border-radius: 5px; padding: 40px;">
              <h4  style="text-align: ${align};"id="${elid}">${data}</h4>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Heading Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    
                </div>
          </div>
      </div>`

            } else if (item == 'paragraph') {
                var t = 0
                if (tab == '1') {
                    t = 30
                } else if (tab == '2') {
                    t = 60
                }
                editor.innerHTML += `
      <div style="width: 90%; margin: 20px auto;">
          <p class="caption" style="margin-bottom: 4px;">Paragraph</p>
          <div style="width: calc(100% - 80px); margin: auto; border: 1px solid transparent; background-color: white; border-radius: 5px; padding: 40px;">
              <p style="text-align: ${align}; text-indent: ${t}px;" id="${elid}">${data}</p>
              <input type="text" class="item-input" id="${elid}input" value="${data}" onkeyup="document.getElementById('${elid}').innerText = document.getElementById('${elid}input').value; addData('${elid}');" placeholder="Paragraph Text...">
              <div style="display: flex; flex-direction: row; margin-top: 30px;">
                    <button class="align-button-start" onclick="align('left', '${elid}')"><img src="imgs/alignleft.svg" alt=""></button>
                    <button class="align-button" onclick="align('right', '${elid}')"><img src="imgs/alignright.svg" alt=""></button>
                    <button class="align-button" onclick="align('center', '${elid}')"><img src="imgs/aligncenter.svg" alt=""></button>
                    <button class="align-button-end" onclick="align('justify', '${elid}')"><img src="imgs/alignjustify.svg" alt=""></button>
                    <div style="display: flex; flex-direction: row; margin-top: 0px; margin-left: 30px;">
                        <button class="align-button-start" onclick="tab('none', '${elid}')">No
                                Tab</button>
                        <button class="align-button" onclick="tab('1', '${elid}')">1</button>
                        <button class="align-button" onclick="tab('2', '${elid}')">2</button>

                    <div style="display: flex; flex-direction: row;">  

                    </div>
                
          </div>
      </div>`

            } else if (item == 'image') {

                datainputs += 1
                editor.innerHTML += `
        <form action="/admin/uploadimage" method="POST" enctype="multipart/form-data">
        <input type="text" name="data" class="datainput" style="display: none;">
            <div style="width: 90%; display: block; margin: 20px auto;">
                <p class="caption" style="margin-bottom: 4px;">Image</p>
                <div style="width: calc(100% - 80px); margin: auto; border: 1px solid transparent; background-color: white; border-radius: 5px; padding: 40px;">
                    <img id="${elid}" src="uploads/resized/${data}" alt="your image" style="width: 50%; margin: auto; display: block; margin-bottom: 30px;" />
                    <input type="file" id="${elid}input" onchange="uploadImage('${elid}')" name="image" />
                    <button type="submit">Upload</button>
                    <input type="text" value="${caption}" class="item-input" style="margin-top: 20px;" id="${elid}inputcap" onkeyup="addDataCaption('${elid}');" placeholder="Caption...">
                </div>
            </div>
        </form>`
                forms += 1

            }
        }

        // document.getElementById('editor').onmousedown = function(e) {
        //     e = e || window.event;
        //     var elementId = (e.target || e.srcElement).id;

        //     // call your re-create function
        //     if ((e.target || e.srcElement).className.includes('edit')) {
        //         console.log(elementId);
        //         document.getElementById('edittitle').innerText = `${elementId}`
        //         console.log(document.getElementById(elementId).tagName)
        //     }
        //     // ...
        // }
    </script>

</body>

</html>